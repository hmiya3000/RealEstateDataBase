//
//  UIPopupPickerView.m
//  LoanHikaku
//
//  Created by MiyazakiHironobu on 2014/07/17.
//  Copyright (c) 2014年 Beetre. All rights reserved.
//

#import "UIPopupPickerView.h"

@interface UIPopupPickerView ()
{
    UIActionSheet       *_as_pvpp;
    UIPickerView        *_pv;

    CGRect              _frame;
    id                  _target;
    NSInteger           _numRow;
    NSInteger           _numComponent;
}
@end

@implementation UIPopupPickerView

/****************************************************************
 * ポップアップ作成
 ****************************************************************/
- (void)makePopup:(CGRect)frame tgt:(id)target
{
    _target         = target;
    _frame          = frame;
    _as_pvpp = [[UIActionSheet alloc] initWithTitle:@"select hoge"
                                        delegate:self
                                  cancelButtonTitle:@"Cancel"
                             destructiveButtonTitle:nil
                                  otherButtonTitles:nil];
    // Add the picker
    _pv   = [[UIPickerView alloc]initWithFrame:CGRectMake(0,44,_frame.size.width,300)];
    [_pv setBackgroundColor:[UIColor whiteColor]];
    [_pv setDelegate:self];
    [_pv setShowsSelectionIndicator:YES];


    UIToolbar *pickerToolbar = [[UIToolbar alloc] initWithFrame:CGRectMake(0, 0, _frame.size.width, 44)];
    pickerToolbar.barStyle = UIBarStyleBlackOpaque;
    [pickerToolbar sizeToFit];
    NSMutableArray *barItems = [[NSMutableArray alloc] init];
    UIBarButtonItem *flexSpace = [[UIBarButtonItem alloc]
                                  initWithBarButtonSystemItem:UIBarButtonSystemItemFlexibleSpace
                                  target:self action:nil];
    [barItems addObject:flexSpace];
    UIBarButtonItem *doneBtn = [[UIBarButtonItem alloc]
                                initWithBarButtonSystemItem:UIBarButtonSystemItemDone
                                target:self action:@selector(pickedData:)];
    [barItems addObject:doneBtn];
    [pickerToolbar setItems:barItems animated:YES];
    [_as_pvpp addSubview:pickerToolbar];
    [_as_pvpp addSubview:_pv];

    return;
}

/****************************************************************
 * PickerViewをポップアップする
 ****************************************************************/
- (void)showPickerView:(UIView*)view
{
    [_as_pvpp showInView:view];
    [_as_pvpp setBounds:CGRectMake(0,0,_frame.size.width, 400)];
    
}
/****************************************************************
 * 指定した列の行番号を設定する
 ****************************************************************/
- (void)selectRow:(NSInteger)row inComponent:(NSInteger)component
{
    [_pv selectRow:row inComponent:component animated:YES];
}

/****************************************************************
 * 指定した列で選択された行番号を返す
 ****************************************************************/
- (NSInteger)selectedRowInComponent:(NSInteger)component
{
    return [_pv selectedRowInComponent:component];
}

/****************************************************************
 *　行数の高さ指定
 ****************************************************************/
-(CGFloat)pickerView:(UIPickerView*)pickerView rowHeightForComponent:(NSInteger)component
{
    return 30;
}

/****************************************************************
 *　ポップアップを閉じる
 ****************************************************************/
- (BOOL)closePopup:(id)sender
{
    BOOL closeYN = [_target closePopup:sender];
    [_as_pvpp dismissWithClickedButtonIndex:0 animated:closeYN];
    return closeYN;
}

/****************************************************************
 * 取得データ決定：継承先でオーバーライド
 ****************************************************************/
- (void)pickedData:(id)sender
{
    [self closePopup:sender];
    return;
}

/****************************************************************
 *　行数設定：継承先でオーバーライド
 ****************************************************************/
-(NSInteger)pickerView:(UIPickerView*)pickerView numberOfRowsInComponent:(NSInteger)component
{
    return 10;
}

/****************************************************************
 * 列数設定：継承先でオーバーライド
 ****************************************************************/
-(NSInteger)numberOfComponentsInPickerView:(UIPickerView*)pickerView
{
    return _numRow;
}

/****************************************************************
 *　行数取得：継承先でオーバーライド
 ****************************************************************/
-(void)pickerView:(UIPickerView *)pickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component
{
    return;
}

/****************************************************************
 * 表示する内容を返す：継承先でオーバーライド
 ****************************************************************/
-(NSString*)pickerView:(UIPickerView*)pickerView
           titleForRow:(NSInteger)row forComponent:(NSInteger)component
{
    return [NSString stringWithFormat:@"%d",(int)row];
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender
{
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
